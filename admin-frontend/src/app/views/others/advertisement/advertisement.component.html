<c-card class="shadow-md rounded-lg mb-6">
    <c-card-header class="flex items-center justify-between flex-wrap gap-2">
        <span class="text-gray-400">Advertisement List</span>
        <div class="gap-3 flex">
            <button (click)="openAddModal()" style="border-radius: 3px;"
                class="px-4 py-2 text-white bg-[#5856d6] hover:bg-[#5856d6e9]">
                Add new Advertisement
            </button>
            <input [(ngModel)]="searchText" (input)="filterAds()"
                class="w-full sm:w-64 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                placeholder="Search advertisements..." />
        </div>
    </c-card-header>

    <div class="overflow-x-auto p-2">
        <table class="min-w-full text-sm text-left border shadow-md rounded-lg">
            <thead>
                <tr>
                    <th class="px-4 py-2 border">S.No.</th>
                    <th class="px-4 py-2 border">Type</th>
                    <!-- <th class="px-4 py-2 border">Image</th> -->
                    <th class="px-4 py-2 border">Image Title</th>
                    <th class="px-4 py-2 border">Status</th>
                    <th class="px-4 py-2 border">Start Date</th>
                    <th class="px-4 py-2 border">End Date</th>
                    <th class="px-4 py-2 border">Action</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let ad of paginatedAds; let i = index">
                    <td class="px-4 py-2 border">{{ (currentPage - 1) * itemsPerPage + i + 1 }}</td>
                    <td class="px-4 py-2 border">{{ ad.type }}</td>
                    <!-- <td class="px-4 py-2 border text-center">
                        <div [ngClass]="ad.type === 'ad3' ? 'w-32 h-40' : 'w-36 h-12'"
                            class="mx-auto flex items-center justify-center overflow-hidden rounded-md border bg-gray-50">
                            <img [src]="getAdImageUrl(ad.image)" alt="Ad Image"
                                class="max-w-full max-h-full object-contain" />
                        </div>
                    </td> -->
                    <td class="px-4 py-2 border">{{ ad.imageTitle }}</td>
                    <td class="px-4 py-2 border">{{ ad.isActive ? 'Active' : 'Inactive' }}</td>
                    <td class="px-4 py-2 border">{{ ad.startDate | date }}</td>
                    <td class="px-4 py-2 border">{{ ad.endDate | date }}</td>
                    <td class="px-4 py-2 border gap-2">
                        <button style="color: blue;" title="Edit" class="p-1" (click)="openEditModal(ad)">
                            <c-icon name="cil-pencil" class="w-5 h-5"></c-icon>
                        </button>
                        <button style="color: red;" title="Delete" class="p-1" (click)="openDeleteModal(ad)">
                            <c-icon name="cil-trash" class="w-5 h-5"></c-icon>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Pagination Controls -->
    <app-pagination class="!z-0" [currentPage]="currentPage" [totalPages]="totalPages"
        (pageChange)="onPageChange($event)">
    </app-pagination>

    <app-confirm-modal [visible]="selectedAdIdToDelete !== null" title="Delete Advertisement"
        message="Are you sure you want to delete this advertisement?" confirmText="Delete" cancelText="Cancel"
        (onConfirm)="handleConfirmDelete()" (onCancel)="handleCancelDelete()">
    </app-confirm-modal>

</c-card>

<!-- Add/Edit Modal -->
<div *ngIf="showModal"
    class="fixed inset-0 bg-opacity-40 backdrop-blur-sm z-[9999] flex items-center justify-center p-4 sm:p-6">
    <div class="bg-white w-full max-w-md sm:max-w-lg rounded-lg shadow-xl p-3 sm:p-6 space-y-5">
        <span class="text-gray-400 sm:text-xl font-semibold">
            {{ editMode ? 'Edit Advertisement' : 'Add Advertisement' }}
        </span>

        <form [formGroup]="advertisementForm" (ngSubmit)="onSubmit()" class="space-y-4" novalidate>
            <!-- Type -->
            <div>
                <label class="block mb-1 text-black text-sm font-medium">Type</label>
                <select formControlName="type"
                    class="w-full border border-gray-300 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="" disabled>Select type</option>
                    <option *ngFor="let type of adTypes" [value]="type">{{ type | uppercase }}</option>
                </select>
                <small class="text-red-500" *ngIf="getError('type')">{{ getError('type') }}</small>
            </div>

            <!-- Image Title -->
            <div>
                <label class="block mb-1 text-black text-sm font-medium">Image Title</label>
                <input formControlName="imageTitle"
                    class="w-full border border-gray-300 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" />
                <small class="text-red-500" *ngIf="getError('imageTitle')">{{ getError('imageTitle') }}</small>
            </div>

            <!-- Start Date -->
            <div>
                <label class="block mb-1 text-black text-sm font-medium">Start Date</label>
                <input type="date" formControlName="startDate"
                    class="w-full border border-gray-300 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" />
                <small class="text-red-500" *ngIf="getError('startDate')">{{ getError('startDate') }}</small>
            </div>

            <!-- End Date -->
            <div>
                <label class="block mb-1 text-black text-sm font-medium">End Date</label>
                <input type="date" formControlName="endDate"
                    class="w-full border border-gray-300 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" />
                <small class="text-red-500" *ngIf="getError('endDate')">{{ getError('endDate') }}</small>
            </div>

            <!-- Image Upload -->
            <div class="text-black">
                <label class="block mb-1 text-sm font-medium">Upload Image</label>
                <input id="adImageUpload" type="file" (change)="onImageSelect($event)" accept="image/*"
                    class="hidden" />
                <label for="adImageUpload"
                    class="w-full cursor-pointer flex flex-col items-center justify-center border border-gray-300 rounded px-4 py-6 transition hover:bg-gray-50 text-center">
                    <span class="text-sm font-medium text-gray-700">Select Image</span>
                </label>
                <div *ngIf="imagePreview" class="mt-2.5 flex justify-center">
                    <img [src]="imagePreview" alt="Preview" class="max-h-40 rounded border border-gray-300" />
                </div>
                <small class="text-red-500" *ngIf="getError('image')">{{ getError('image') }}</small>
            </div>

            <!-- Buttons -->
            <div class="flex justify-end gap-2">
                <button type="button" (click)="closeModal()"
                    class="px-4 py-2 border border-red-500 rounded text-red-500 text-sm">
                    Cancel
                </button>
                <button type="submit" class="px-4 py-2 bg-primary text-white rounded hover:bg-blue-600 text-sm">
                    Submit
                </button>
            </div>
        </form>
    </div>
</div>