<c-card class="shadow-md rounded-lg mb-6">
    <c-card-header class="flex items-center justify-between flex-wrap gap-2">
        <span class="text-gray-400">Happy Customer List</span>
        <div class="gap-3 flex">
            <button (click)="openAddModal()" style="border-radius: 3px;"
                class="px-4 py-2 text-white bg-[#5856d6] hover:bg-[#5856d6e9]">
                Add Happy Customer
            </button>
            <input [(ngModel)]="searchText"
                class="w-full sm:w-64 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                placeholder="Search happy customer..." />
        </div>
    </c-card-header>

    <div class="overflow-x-auto p-2">
        <table class="min-w-full text-sm text-left border shadow-md rounded-lg">
            <thead>
                <tr>
                    <th class="px-4 py-2 border">S.No.</th>
                    <th class="px-4 py-2 border">Name</th>
                    <th class="px-4 py-2 border">Image</th>
                    <th class="px-4 py-2 border">Message</th>
                    <th class="px-4 py-2 border">Status</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let happy of paginatedCustomers">
                    <td class="px-4 py-2 border">{{ happy.serial }}</td>
                    <td class="px-4 py-2 border">{{ happy.name }}</td>
                    <td class="px-4 py-2 border text-center justify-center flex">
                        <div class="w-22 h-22 text-center justify-center flex">
                            <img [src]="happy.image" alt="Customer Image" class="w-full h-full object-cover" />
                        </div>
                    </td>
                    <td class="px-4 py-2 border">{{ happy.message }}</td>
                    <td class="px-4 py-2 border"><button style="color: blue;" title="Edit" class="p-1"
                            (click)="openEditModal(happy)">
                            <c-icon name="cil-pencil" class="w-5 h-5"></c-icon>
                        </button>

                        <button style="color: red;" title="Delete" class="p-1" (click)="openDeleteModal(happy)">
                            <c-icon name="cil-trash" class="w-5 h-5"></c-icon>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Pagination Controls -->
    <app-pagination class="!z-0" [currentPage]="currentPage" [totalPages]="totalPages"
        (pageChange)="onPageChange($event)">
    </app-pagination>


    <app-confirm-modal [visible]="selectedCustomerId !== null" title="Delete Customer"
        message="Are you sure you want to delete this customer?" confirmText="Delete" cancelText="Cancel"
        (onConfirm)="handleConfirmDelete()" (onCancel)="selectedCustomerId = null">
    </app-confirm-modal>

</c-card>



<!-- Add/Edit Modal -->
<div *ngIf="showModal"
    class="fixed inset-0 bg-opacity-40 backdrop-blur-sm z-[9999] flex items-center justify-center p-4 sm:p-6">
    <div class="bg-white w-full max-w-md sm:max-w-lg rounded-lg shadow-xl p-3 sm:p-6 space-y-5">
        <span class="text-gray-400 sm:text-xl font-semibold">
            {{ editMode ? 'Edit Happy Customer' : 'Add Happy Customer' }}
        </span>

        <form [formGroup]="happyCustomerForm" (ngSubmit)="onSubmit()" class="space-y-4" novalidate>
            <!-- Name -->
            <div>
                <label class="block mb-1 text-black text-sm font-medium">Name</label>
                <input formControlName="name"
                    class="w-full border border-gray-300 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" />
                <small class="text-red-500" *ngIf="submitted && getError('name')">
                    {{ getError('name') }}
                </small>
            </div>

            <!-- Message -->
            <div>
                <label class="block mb-1 text-sm text-black font-medium">Message</label>
                <textarea formControlName="message" rows="3" maxlength="30"
                    class="w-full border border-gray-300 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                <small class="text-red-500" *ngIf="submitted && getError('message')">
                    {{ getError('message') }}
                </small>
            </div>

            <!-- Image -->
            <div class="text-black">
                <label class="block mb-1 text-sm font-medium">Upload Image</label>
                <input id="customerImageUpload" type="file" (change)="onImageSelect($event)" accept="image/*"
                    class="hidden" />
                <label for="customerImageUpload"
                    class="w-full cursor-pointer flex flex-col items-center justify-center border border-gray-300 rounded px-4 py-6 transition hover:bg-gray-50 text-center">
                    <span class="text-sm font-medium text-gray-700">Select Image</span>
                </label>
                <div *ngIf="imagePreview" class="mt-2.5 flex justify-center">
                    <img [src]="imagePreview" alt="Preview" class="max-h-40 rounded border border-gray-300" />
                </div>
                <small class="text-red-500" *ngIf="submitted && getError('image')">
                    {{ getError('image') }}
                </small>
            </div>

            <!-- Buttons -->
            <div class="flex justify-end gap-2">
                <button type="button" (click)="closeModal()"
                    class="px-4 py-2 border border-red-500 rounded text-red-500 text-sm">
                    Cancel
                </button>
                <button type="submit" class="px-4 py-2 bg-primary text-white rounded hover:bg-blue-600 text-sm">
                    Submit
                </button>
            </div>
        </form>
    </div>
</div>
