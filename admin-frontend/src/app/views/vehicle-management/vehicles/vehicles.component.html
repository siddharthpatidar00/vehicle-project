<c-card class="shadow-md rounded-lg mb-6">
    <c-card-header class="flex items-center justify-between flex-wrap gap-2">
        <span class="text-gray-400">Vehicle List</span>
        <div class="gap-3 flex">
            <button (click)="openModal()" style="border-radius: 3px;"
                class="px-4 py-2 text-white bg-[#5856d6] hover:bg-[#5856d6e9]">
                Add Vehicle
            </button>

            <input [(ngModel)]="searchQuery"
                class="w-full sm:w-64 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                placeholder="Search vehicle..." />
        </div>
    </c-card-header>
    <c-card-body class="p-0">
        <!-- Desktop Table -->
        <div class="overflow-x-auto hidden sm:block p-2">
            <table class="min-w-full text-sm text-left border shadow-md rounded-lg">
                <thead>
                    <tr>
                        <th class="px-4 py-2 border">S.No.</th>
                        <th class="px-4 py-2 border">Users</th>
                        <th class="px-4 py-2 border">Phone Number</th>
                        <th class="px-4 py-2 border">Vehicle Name</th>
                        <th class="px-4 py-2 border">Model</th>
                        <th class="px-4 py-2 border">Brand</th>
                        <th class="px-4 py-2 border">Image</th>
                        <th class="px-4 py-2 border">Status</th>
                        <th class="px-4 py-2 border text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr
                        *ngFor="let category of paginatedVehicles | slice:(currentPage - 1) * itemsPerPage:(currentPage * itemsPerPage); let i = index">
                        <td class="px-4 py-2 border">{{ (currentPage - 1) * itemsPerPage + i + 1 }}</td>
                        <td class="px-4 py-2 border">{{category.createdBy}}</td>
                        <td class="px-4 py-2 border">{{ category.phone || '-' }}</td>
                        <td class="px-4 py-2 border">{{ category.name }}</td>
                        <td class="px-4 py-2 border">{{ category.model }}</td>
                        <td class="px-4 py-2 border">{{ category.brand }}</td>
                        <td class="px-4 py-2 border w-45">
                            <div class="w-full h-24 flex items-center justify-center overflow-hidden border rounded">
                                <img *ngIf="category.img" [src]="'http://localhost:5000' + category.img[0]"
                                    alt="Vehicle" class="w-full h-full object-cover" />
                            </div>
                        </td>
                        <td class="px-4 py-2 border text-center">
                            <span class="px-2 py-1 text-white rounded" [ngClass]="{
  'bg-green-500': category.status === 'Available',
  'bg-red-500': category.status === 'Sold',
  'bg-blue-500': category.status === 'Rented',
  'bg-yellow-500': category.status === 'Maintenance',
  'bg-orange-500': category.status === 'Inactive'
}">
                                {{ category.status }}
                            </span>

                        </td>

                        <td class="px-4 py-2 border text-center">
                            <div class="flex items-center justify-center gap-2">
                                <button (click)="openViewModal(category)" title="View" class="text-green-600">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M2.458 12C3.732 7.943 7.523 5 12 5s8.268 2.943 9.542 7c-1.274 4.057-5.065 7-9.542 7s-8.268-2.943-9.542-7z" />
                                    </svg>
                                </button>

                                <button style="color: blue;" title="Edit" class="p-1" (click)="editVehicle(category)">
                                    <c-icon name="cil-pencil" class="w-5 h-5"></c-icon>
                                </button>
                                <button style="color: red;" title="Delete" class="p-1"
                                    (click)="deleteVehicle(category)">
                                    <c-icon name="cil-trash" class="w-5 h-5"></c-icon>
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Mobile Cards -->
        <div class="sm:hidden flex flex-col space-y-4 p-2">
            <c-card class="shadow-sm rounded-lg"
                *ngFor="let category of paginatedVehicles | slice:(currentPage - 1) * itemsPerPage:(currentPage * itemsPerPage); let i = index">
                <c-card-body class="p-4">
                    <div class="flex justify-between mb-2">
                        <span class="font-semibold">S.No.</span>
                        <span>{{ (currentPage - 1) * itemsPerPage + i + 1 }}</span>
                    </div>
                    <div class="flex justify-between mb-2">
                        <span class="font-semibold">Name</span>
                        <span>{{ category.name }}</span>
                    </div>
                    <div class="flex justify-between mb-2">
                        <span class="font-semibold">Model</span>
                        <span>{{ category.model }}</span>
                    </div>
                    <div class="flex justify-between mb-2">
                        <span class="font-semibold">Brand</span>
                        <span>{{ category.brand }}</span>
                    </div>
                    <div class="flex justify-between mb-4">
                        <span class="font-semibold">Image</span>
                        <img *ngIf="category.img" [src]="'http://localhost:5000' + category.img"
                            class="w-24 h-16 object-cover rounded" alt="Vehicle" />
                    </div>
                    <div class="flex justify-between mb-2">
                        <span class="font-semibold">Status</span>
                        <button class="font-semibold">
                            {{ category.status }}
                        </button>
                    </div>
                    <div class="flex items-center justify-end gap-2 mt-4">
                        <button (click)="openViewModal(category)" title="View" class="text-green-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M2.458 12C3.732 7.943 7.523 5 12 5s8.268 2.943 9.542 7c-1.274 4.057-5.065 7-9.542 7s-8.268-2.943-9.542-7z" />
                            </svg>
                        </button>
                        <button title="Edit" (click)="editVehicle(category)" class="text-blue-600">
                            <c-icon name="cil-pencil" class="w-5 h-5"></c-icon>
                        </button>
                        <button title="Delete" (click)="deleteVehicle(category)" class="text-red-600">
                            <c-icon name="cil-trash" class="w-5 h-5"></c-icon>
                        </button>
                    </div>
                </c-card-body>
            </c-card>
        </div>
        <!-- Pagination Controls -->
        <app-pagination [currentPage]="currentPage" [totalPages]="totalPages" (pageChange)="onPageChange($event)">
        </app-pagination>

        <app-confirm-modal [visible]="confirmVisible" title="Delete Vehicle" (onConfirm)="handleConfirmDelete()"
            (onCancel)="handleCancelDelete()" message="Are you sure you want to delete this vehicle?"
            confirmText="Delete" cancelText="Cancel">
        </app-confirm-modal>
    </c-card-body>
</c-card>
<!-- Add/Edit Vehicle Modal -->
<div *ngIf="showModal"
    class="fixed inset-0 backdrop-blur-sm bg-opacity-30 z-[9999] flex items-center justify-center p-4">
    <div class="bg-white w-full max-w-2xl rounded-lg shadow-xl p-6 space-y-6 overflow-y-auto max-h-[90vh]">
        <c-card-header class="flex items-center justify-between mb-4">
            <span class="text-gray-400 font-semibold text-xl">
                {{ editMode ? 'Edit Vehicle' : 'Add Vehicle' }}
            </span>
        </c-card-header>
        <form [formGroup]="vehicleForm" (ngSubmit)="onSubmit()" class="grid grid-cols-1 sm:grid-cols-2 gap-6">
            <div class="text-black">
                <label class="block mb-1 text-sm font-medium">Vehicle Name</label>
                <input type="text" formControlName="name" placeholder="Enter Vehicle Name"
                    class="w-full text-gray-600 border rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" />
                <small class="text-red-500" *ngIf="submitted && getError('name')">
                    {{ getError('name') }}
                </small>
            </div>

            <div class="text-black">
                <label class="block mb-1 text-sm font-medium">Model</label>
                <input type="text" formControlName="model" placeholder="Enter Model"
                    class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" />
            </div>

            <!-- Brand & Category Row -->
            <div class="sm:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-6">
                <div class="text-black">
                    <label class="block mb-1 text-sm font-medium">Brand</label>
                    <select formControlName="brand"
                        class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">-- Select Brand --</option>
                        <option *ngFor="let b of brands" [value]="b.brand_name">
                            {{ b.brand_name }}
                        </option>
                    </select>
                    <small class="text-red-500" *ngIf="submitted && getError('brand')">
                        {{ getError('brand') }}
                    </small>
                </div>

                <div class="text-black">
                    <label class="block mb-1 text-sm font-medium">Category</label>
                    <select formControlName="category"
                        class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">-- Select Category --</option>
                        <option *ngFor="let c of categories" [value]="c.category_name">
                            {{ c.category_name }}
                        </option>
                    </select>
                    <small class="text-red-500" *ngIf="submitted && getError('category')">
                        {{ getError('category') }}
                    </small>
                </div>
            </div>
            <div class="text-black">
                <label class="block mb-1 text-sm font-medium">KM Driven</label>
                <input type="number" formControlName="km_driven" placeholder="Enter K.M. Driven"
                    class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" />
            </div>

            <div class="text-black">
                <label class="block mb-1 text-sm font-medium">Ownership</label>
                <select formControlName="ownership"
                    class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option>First</option>
                    <option>Second</option>
                    <option>Third</option>
                    <option>Fourth+</option>
                </select>
            </div>

            <div class="text-black">
                <label class="block mb-1 text-sm font-medium">Manufacture Year</label>
                <input type="number" formControlName="manufacture_year" placeholder="Enter Manufacture Year" min="1900" max="2099"
                    step="1"
                    class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" />
            </div>

            <div class="text-black">
                <label class="block mb-1 text-sm font-medium">Insured</label>
                <select formControlName="isInsured"
                    class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="" disabled>Select status</option>
                    <option value="true">Yes</option>
                    <option value="false">No</option>
                </select>
                <small class="text-red-500" *ngIf="submitted && getError('isInsured')">
                    {{ getError('isInsured') }}
                </small>
            </div>

            <div class="text-black">
                <label class="block mb-1 text-sm font-medium">Insurance Valid Till</label>
                <input type="date" formControlName="insuranceValidTill"
                    class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" />
            </div>

            <div class="text-black">
                <label class="block mb-1 text-sm font-medium">Price</label>
                <input type="number" formControlName="price" placeholder="Enter Price"
                    class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" />
            </div>

            <div class="text-black">
                <label class="block mb-1 text-sm font-medium">Status</label>
                <select formControlName="status"
                    class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="" disabled>Select status</option>
                    <option>Available</option>
                    <option>Sold</option>
                    <option>Rented</option>
                    <option>Maintenance</option>
                    <option>Inactive</option>
                </select>
            </div>

            <div class="text-black">
                <label class="block mb-1 text-sm font-medium">Sell / Rent</label>
                <select formControlName="sell_or_rent"
                    class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="" disabled>Select option</option>
                    <option>Sell</option>
                    <option>Rent</option>
                </select>
                <small class="text-red-500" *ngIf="submitted && getError('sell_or_rent')">
                    {{ getError('sell_or_rent') }}
                </small>
            </div>

            <div class="sm:col-span-2 text-black">
                <label class="block mb-1 text-sm font-medium">Upload Vehicle Images (1â€“5)</label>

                <input id="vehicleImageUpload" type="file" multiple (change)="onFileSelected($event)" accept="image/*"
                    class="hidden" />

                <label for="vehicleImageUpload"
                    class="block w-full border rounded px-3 py-2 text-sm text-gray-700 cursor-pointer text-center">
                    Select Images
                </label>

                <!-- ðŸ‘‡ Preview Grid -->
                <div *ngIf="imagePreviews.length > 0" class="mt-3 grid grid-cols-2 sm:grid-cols-3 gap-2">
                    <div *ngFor="let preview of imagePreviews; let i = index" class="relative">
                        <img [src]="preview" alt="Vehicle Preview" class="w-full h-32 object-cover border rounded" />
                        <button type="button" (click)="removeImage(i)"
                            class="absolute top-1 right-1 bg-red-600 text-white text-xs px-2 py-1 rounded">
                            âœ•
                        </button>
                    </div>
                </div>
            </div>





            <div class="sm:col-span-2 text-black">
                <label class="block mb-1 text-sm font-medium">Description</label>
                <textarea formControlName="description" placeholder="Short description..."
                    class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
            </div>

            <div class="sm:col-span-2 flex justify-end gap-4 pt-4">
                <button type="button" (click)="closeModal()"
                    class="px-4 py-2 text-sm font-medium bg-red-500 text-white rounded hover:bg-red-600 transition-all">
                    Cancel
                </button>
                <button type="submit" class="px-5 py-2 bg-[#5856d6] text-white rounded hover:bg-[#4d4ac7]">
                    {{ editMode ? 'Update' : 'Submit' }}
                </button>
            </div>
        </form>

    </div>
</div>
<!-- View Vehicle Modal -->
<div *ngIf="showViewModal"
    class="fixed inset-0 bg-opacity-30 backdrop-blur-sm z-[9999] flex items-center justify-center p-4">
    <div class="bg-white w-full max-w-2xl rounded-lg shadow-xl p-6 space-y-6 overflow-y-auto max-h-[90vh]">
        <span class="font-semibold text-gray-400 mb-4 pb-4">Vehicle Details</span>

        <div *ngIf="selectedVehicle" class="overflow-x-auto">
            <table class="w-full border border-gray-300 text-sm sm:text-base border-collapse">
                <tbody>
                    <tr>
                        <td class="p-3 font-medium text-gray-600 border border-gray-300 w-1/2">Name</td>
                        <td class="p-3 text-gray-800 border border-gray-300">{{ selectedVehicle.name }}</td>
                    </tr>
                    <tr>
                        <td class="p-3 font-medium text-gray-600 border border-gray-300">Model</td>
                        <td class="p-3 text-gray-800 border border-gray-300">{{ selectedVehicle.model }}</td>
                    </tr>
                    <tr>
                        <td class="p-3 font-medium text-gray-600 border border-gray-300">Brand</td>
                        <td class="p-3 text-gray-800 border border-gray-300">{{ selectedVehicle.brand }}</td>
                    </tr>
                    <tr>
                        <td class="p-3 font-medium text-gray-600 border border-gray-300">Category</td>
                        <td class="p-3 text-gray-800 border border-gray-300">{{ selectedVehicle.category_name }}</td>
                    </tr>
                    <tr>
                        <td class="p-3 font-medium text-gray-600 border border-gray-300">Phone Number</td>
                        <td class="p-3 text-gray-800 border border-gray-300">{{ selectedVehicle.phone || '-' }}</td>
                    </tr>
                    <tr>
                        <td class="p-3 font-medium text-gray-600 border border-gray-300">KM Driven</td>
                        <td class="p-3 text-gray-800 border border-gray-300">{{ selectedVehicle.km_driven }}</td>
                    </tr>
                    <tr>
                        <td class="p-3 font-medium text-gray-600 border border-gray-300">Ownership</td>
                        <td class="p-3 text-gray-800 border border-gray-300">{{ selectedVehicle.ownership }}</td>
                    </tr>
                    <tr>
                        <td class="p-3 font-medium text-gray-600 border border-gray-300">Manufacture Year</td>
                        <td class="p-3 text-gray-800 border border-gray-300">{{ selectedVehicle.manufacture_year }}</td>
                    </tr>
                    <tr>
                        <td class="p-3 font-medium text-gray-600 border border-gray-300">Insured</td>
                        <td class="p-3 text-gray-800 border border-gray-300">
                            {{ selectedVehicle.isInsured ? 'Yes' : 'No' }}
                        </td>
                    </tr>
                    <tr>
                        <td class="p-3 font-medium text-gray-600 border border-gray-300">Insurance Valid Till</td>
                        <td class="p-3 text-gray-800 border border-gray-300">
                            {{ getFormattedDate(selectedVehicle.insuranceValidTill) }}
                        </td>
                    </tr>
                    <tr>
                        <td class="p-3 font-medium text-gray-600 border border-gray-300">Price</td>
                        <td class="p-3 text-gray-800 border border-gray-300">â‚¹{{ selectedVehicle.price }}</td>
                    </tr>
                    <tr>
                        <td class="p-3 font-medium text-gray-600 border border-gray-300">Status</td>
                        <td class="p-3 text-gray-800 border border-gray-300">{{ selectedVehicle.status }}</td>
                    </tr>
                    <tr>
                        <td class="p-3 font-medium text-gray-600 border border-gray-300">Sell / Rent</td>
                        <td class="p-3 text-gray-800 border border-gray-300">{{ selectedVehicle.sell_or_rent }}</td>
                    </tr>
                    <tr class="align-top">
                        <td class="p-3 font-medium text-gray-600 border border-gray-300">Description</td>
                        <td class="p-3 text-gray-800 border border-gray-300 whitespace-pre-wrap break-words max-w-sm">
                            {{ selectedVehicle.description }}
                        </td>
                    </tr>
                    <tr>
                        <td class="p-3 font-medium text-gray-600 border border-gray-300">Image</td>
                        <td class="p-3 border border-gray-300">
                            <div class="grid grid-cols-1 gap-2 w-full h-auto">
                                <img *ngFor="let image of selectedVehicle.img" [src]="'http://localhost:5000' + image"
                                    alt="Vehicle Image" class="w-full h-40 object-cover border rounded shadow-sm" />
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="flex justify-end mt-6">
            <button (click)="closeViewModal()"
                class="px-4 py-2 text-sm font-medium bg-red-500 text-white rounded hover:bg-red-600 transition-all">
                Close
            </button>
        </div>
    </div>
</div>